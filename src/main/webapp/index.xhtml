<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <h:outputStylesheet library="css" name="style.css"/>
    <h:outputScript library="js" name="script.js"/>
    <title>Logistics-board</title>
</h:head>
<h:body>

    <f:view>
        <h:form>
            <p:remoteCommand name="updateGeneralInfo" process="general-info" update="general-info"/>
        </h:form>
        <h:form>
            <p:remoteCommand name="updateDriverInfo" process="driver-info" update="driver-info"/>
        </h:form>
        <h:form>
            <p:remoteCommand name="updateTruckInfo" process="truck-info" update="truck-info"/>
        </h:form>
        <!--<h:form>
            <p:remoteCommand name="updateOrderInfo" process="order-info" update="order-info"/>
        </h:form>-->

        <p:socket onMessage="generalInfoListener" channel="/generalInfo"/>

        <p:socket onMessage="driverInfoListener" channel="/driverInfo"/>

        <p:socket onMessage="truckInfoListener" channel="/truckInfo"/>

        <!--<p:socket onMessage="updateOrderInfo()" channel="/orderInfo"/>-->

        <p:dataTable id="general-info" var="info" value="#{generalInfoMBean.generalInfo}">
            <f:facet name="header">General information</f:facet>
            <p:column>
                <p:panelGrid>
                    <p:row>
                        <p:column>Drivers number</p:column>
                        <p:column id="drivers-number"><h:outputText value="#{info.driverQty}"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column>Vacant drivers number</p:column>
                        <p:column id="vacant-drivers"><h:outputText value="#{info.vacantDriverQty}"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column>Not available drivers number</p:column>
                        <p:column id="not-av-drivers"><h:outputText value="#{info.notAvailableDriverQty}"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column>Trucks number</p:column>
                        <p:column id="trucks-number"><h:outputText value="#{info.truckQty}"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column>Vacant trucks number</p:column>
                        <p:column id="vacant-trucks"><h:outputText value="#{info.vacantTruckQty}"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column>On order trucks number</p:column>
                        <p:column id="on-order-trucks"><h:outputText value="#{info.onOrderTruckQty}"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column>Not working trucks number</p:column>
                        <p:column id="not-working-trucks"><h:outputText value="#{info.notWorkingTruckQty}"/></p:column>
                    </p:row>
                </p:panelGrid>
            </p:column>
        </p:dataTable>

        <p:dataTable emptyMessage="" id="driver-info" var="driver" value="#{driverInfoMBean.allDriversInfo}">
            <f:facet name="header">Drivers information</f:facet>
            <p:column headerText="Personal number" id="driver-personal-number-#{driver.id}">
                <h:outputText value="#{driver.personalNumber}"/>
            </p:column>
            <p:column headerText="First name" id="driver-firstname-#{driver.id}">
                <h:outputText value="#{driver.firstName}"/>
            </p:column>
            <p:column headerText="Last name" id="driver-lastname-#{driver.id}">
                <h:outputText value="#{driver.lastName}"/>
            </p:column>
            <p:column headerText="Current city" id="driver-current-city-#{driver.id}">
                <h:outputText value="#{driver.currentCity.name}"/>
            </p:column>
            <p:column headerText="Already worked hours" id="driver-already-worked-hours-#{driver.id}">
                <h:outputText value="#{driver.alreadyWorkedHrs}"/>
            </p:column>
            <p:column headerText="Remain hours" id="driver-remain-hours-#{driver.id}">
                <h:outputText value="#{driver.remainHrs}"/>
            </p:column>
            <p:column headerText="Status" id="driver-status-#{driver.id}">
                <h:outputText value="On order" rendered="#{driver.onOrder}"/>
                <h:outputText value="Vacant" rendered="#{!driver.onOrder}"/>
            </p:column>
        </p:dataTable>

        <p:dataTable emptyMessage="" id="truck-info" var="truck" value="#{truckInfoMBean.allTrucksInfo}">
            <f:facet name="header">Trucks information</f:facet>
            <p:column headerText="Number plate" id="truck-number-plate-#{truck.id}">
                <h:outputText value="#{truck.numberPlate}"/>
            </p:column>
            <p:column headerText="Current city" id="truck-current-city-#{truck.id}">
                <h:outputText value="#{truck.currentCity.name}"/>
            </p:column>
            <p:column headerText="Crew">
                <p:dataList type="ordered" styleClass="datalist-noborder" id="truck-crew-#{truck.id}"
                            rendered="#{!truck.crew.users.isEmpty() and truck.crew.users != null}" emptyMessage=""
                            value="#{truck.crew.users}" var="user">
                    #{user.personalNumber} - #{user.firstName} #{user.lastName}
                </p:dataList>
            </p:column>
            <p:column headerText="Functioning" id="truck-functioning-#{truck.id}">
                <h:outputText value="Yes" rendered="#{truck.functioning}"/>
                <h:outputText value="No" rendered="#{!truck.functioning}"/>
            </p:column>
            <p:column headerText="Status" id="truck-status-#{truck.id}">
                <h:outputText value="On order" rendered="#{truck.onOrder}"/>
                <h:outputText value="Vacant" rendered="#{!truck.onOrder}"/>
            </p:column>
        </p:dataTable>
    </f:view>
</h:body>

</html>
